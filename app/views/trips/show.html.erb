<!-- Post header begins-->
<div id="post_header" class="container" style="height:40px">
</div>
<div id="content-top-border" class="container">
</div>
<!-- Post header ends -->
<div id="content">
  <div class="container background-white">
    <div class="row margin-vert-30">
      <!-- Main Column -->
      <div class="col-md-12">
        <div id="map"></div>
        <div class="blog-post">
          <div class="blog-item-header">
            <h2>
              <a href="#">
                <%=@trip.title.titleize%>
              </a>
            </h2>
          </div>
          <div class="blog-post-details">
            <!-- Author Name -->
            <div class="blog-post-details-item blog-post-details-item-left user-icon">
              <i class="fa fa-user color-gray-light"></i>
              <a href="#"><%=@user.name%></a>
            </div>
            <!-- End Author Name -->
            <!-- Date -->
            <div class="blog-post-details-item blog-post-details-item-left">
              <i class="fa fa-calendar color-gray-light"></i>
              <a href="#"><%=@trip.created_at.strftime("%d %b. %Y")%></a>
            </div>
            <!-- End Date -->
            <!-- # of Comments -->
            <div class="blog-post-details-item blog-post-details-item-left blog-post-details-item-last">
              <a href="">
                <i class="fa fa-comments color-gray-light"></i>
                <%=@trip.comments.count%> Comments
              </a>
            </div>
            <!-- End # of Comments -->
            <!-- Views -->
            <div class="blog-post-details-item blog-post-details-item-left blog-post-details-item-last">
              <a href="">
                <i class="fa fa-comments color-gray-light"></i>
                <%=@trip.impressionist_count(:filter=>:user_id)%> Views
              </a>
            </div>
            <!-- Views end -->
            <!-- Like -->
            <div class="blog-post-details-item blog-post-details-item-left blog-post-details-item-last">
              <span class="pull-right">
                <%if @likeable%>
                <%= link_to trips_like_path(trip: @trip, like: true), method: 'post' do %>
                Like this Trip  <i class="fa fa-thumbs-o-up fa-lg" aria-hidden="true"></i>
                <%end%>
                <%else%>
                <%= @trip.likes.size %> likes
                <%end%>
              </span>
            </div>
            <!-- Like end -->
          </div>
          <div class="pull-right">
            <%= button_to "Edit This Story", edit_trip_path ,:method=> :get, remote: false, :class=>"btn btn-info"%>
          </div>
          <div class="blog-item">
            <div class="clearfix"></div>
            <div class="blog-post-body row margin-top-15">
              <div class="col-md-4">
                <%=image_tag @trip.main_image, :class=>"margin-bottom-20"%>
              </div>
              <div class="col-md-8">
                <p><%=@trip.description%></p>
              </div>
              <!-- Trip content carousel start -->

              <!-- End Trip content carousel -->
              <div class="col-md-12">
                <%=@trip.content.html_safe%>
                <blockquote class="primary">
                  <p>
                    <em>"Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat."</em>
                  </p>
                  <small>
                    Someone famous in
                    <cite title="Source Title">Source Title</cite>
                  </small>
                </blockquote>
              </div>
            </div>
          </div>
        </div>
        <!-- End Trip Post -->
      </div>
      <!-- End Main Column -->
    </div>
    <!-- Trip item footer start -->
    <div class="row margin-vert-30">
      <!-- Comments and about author start -->
      <div class="blog-item-footer col-md-9">
        <!-- About the Author -->
        <div class="blog-author panel panel-default margin-bottom-30">
          <div class="panel-heading">
            <h3>About the Author</h3>
          </div>
          <div class="panel-body">
            <div class="row">
              <div class="col-md-2">
                <%=image_tag("profiles/87.jpg", :class=>"pull-left")%>
              </div>
              <div class="col-md-10">
                <label>John Doe</label>
                <p>Lorem ipsum dolor sit amet, in pri offendit ocurreret. Vix sumo ferri an. pfs adodio fugit delenit ut qui. Omittam suscipiantur ex vel,ex audiam intellegat gfIn labitur discere eos, nam an feugiat voluptua.</p>
              </div>
            </div>
          </div>
        </div>
        <!-- End About the Author -->
        <!-- Comments -->
        <div class="blog-recent-comments panel panel-default margin-bottom-30">
          <div class="panel-heading">
            <h3>Comments</h3>
          </div>
          <ul class="list-group">
            <% if @trip.comments.present? %>
            <%@trip.comments.each do |c|%>
            <li class="list-group-item">
              <div class="row">
                <div class="col-md-2 profile-thumb">
                  <a href="#">
                    <%=image_tag("profiles/99.jpg", :class=>"media-object")%>
                  </a>
                </div>
                <div class="col-md-10">
                  <label><%=c.user.name%></label>
                  <p><%=c.message%></p>
                  <span class="date">
                    <i class="fa fa-clock-o color-gray-light"></i><%= c.created_at.strftime("%d %b. %Y")%></span>
                  </div>
                </div>
              </li>
              <%end%>
              <%end%>

              <!-- Comment Form -->
              <li class="list-group-item">
                <div class="blog-comment-form">
                  <div class="row margin-top-20">
                    <div class="col-md-12">
                      <div class="pull-left">
                        <h3>Leave a Comment</h3>
                      </div>
                    </div>
                  </div>
                  <div class="row margin-top-20">
                    <div class="col-md-12">
                      <%= form_for :comment, :url =>comments_path(@trip), :method=> 'post' do |f| %>
                      <label>Message</label>
                      <div class="row margin-bottom-20">
                        <div class="col-md-11 col-md-offset-0">
                          <%= f.text_area :message,:class =>"form-control", :rows =>"8"%>
                        </div>
                        <%= f.hidden_field :trip_id, :value => @trip.id %>
                      </div>
                      <p>
                        <%= f.submit "Send Message", :class=>"btn btn-primary" %>
                      </p>
                      <%end%>
                    </div>
                  </div>
                </div>
              </li>
              <!-- End Comment Form -->
            </ul>
          </div>
          <!-- End Comments -->
        </div>
        <!-- End Comments and about container -->
        <!-- Side Column -->
        <div class="col-md-3">
          <!-- Trip Tags -->
          <div class="blog-tags">

          </div>
          <!-- End Trip Tags -->
          <!-- Recently Added Tosts -->
          <div class="recent-posts">
            <h3>Recently Added Trips</h3>
            <ul class="posts-list margin-top-10">
              <%@trips.last(5).each do |t|%>
              <li>
                <div class="recent-post">
                  <%= link_to (image_tag t.main_image, :class=>"pull-left small"), trip_path(t)%>
                  <%= link_to t.title, trip_path(t)%>
                  <!-- <a href="#" class="posts-list-title"><%=t.title%></a> -->
                  <br>
                  <span class="recent-post-date">
                    <%=t.created_at.strftime("%d %b. %Y")%>
                  </span>
                </div>
                <div class="clearfix"></div>
              </li>
              <%end%>
            </ul>
          </div>
          <!-- End Recently Added Tosts -->
          <!-- End Side Column -->
        </div>
        <!-- Trip item footer end -->
      </div>
    </div>
  </div>
  <!-- === END CONTENT === -->

  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD_21910Bt7xVDIzMDB_UXtpCSC75BO0aw&callback=initMap"></script>

  <script>
    function initMap() {
      var directionsService = new google.maps.DirectionsService;
      var directionsDisplay = new google.maps.DirectionsRenderer;
      var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 7,
        scaleControl: false,
        scrollwheel: false,
        center: {lat: 20.5937, lng: 78.9629}
      });
      directionsDisplay.setMap(map);
      calculateAndDisplayRoute(directionsService, directionsDisplay);
    }

    function calculateAndDisplayRoute(directionsService, directionsDisplay) {
      var checkpoints = <%=raw @trip.waypoints%>
      var waypointsArray = [];
      if (checkpoints.length > 0){
        for(i=0; i< checkpoints.length; i++){
          waypointsArray.push({location: checkpoints[i]})
        }
      }

      directionsService.route({
        origin: '<%=@trip.from_address%>',
        destination: '  <%=@trip.to_address%>',
        waypoints: waypointsArray,
        travelMode: google.maps.TravelMode.DRIVING
      }, function(response, status) {
        if (status === google.maps.DirectionsStatus.OK) {
          directionsDisplay.setDirections(response);
        } else {
          window.alert('Directions request failed due to ' + status);
        }
      });
    }
  </script>
